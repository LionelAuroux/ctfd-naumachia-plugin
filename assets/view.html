<div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-body">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
            </button>
            
            <h2 class="challenge-name text-center pt-3 mb-0">{{ challenge.name }}</h2>
            <h3 class="challenge-value text-center">{{ challenge.value }}</h3>

            <div class="challenge-tags text-center mb-3">
                {% for tag in tags %}
                    <span class="badge bg-info challenge-tag">{{ tag }}</span>
                {% endfor %}
            </div>

            <div class="challenge-desc mb-3">
                <div id="challenge-desc-content">{{ challenge.description }}</div>
            </div>

            <!-- Naumachia VPN Config Download Button -->
            <div class="row challenge-files text-center pb-3">
                <div class="col-md-6 col-sm-6 col-xs-12 offset-md-3 file-button-wrapper d-block">
                    <a class="btn btn-info btn-file mb-1 d-inline-block px-2 w-100 text-truncate"
                       href="/naumachia/config/{{ challenge.id }}">
                        <i class="fas fa-download"></i>
                        <small>Download OpenVPN Config</small>
                    </a>
                </div>
            </div>

            <!-- Other challenge files -->
            <div class="row challenge-files text-center pb-3">
                {% for file in files %}
                    <div class="col-md-4 col-sm-4 col-xs-12 file-button-wrapper d-block">
                        <a class="btn btn-info btn-file mb-1 d-inline-block px-2 w-100 text-truncate"
                           href="{{ file }}">
                            <i class="fas fa-download"></i>
                            <small>
                                {% set segments = file.split('/') %}
                                {% set filename = segments | last %}
                                {% set token = filename.split('?') | last %}
                                {% if token %}
                                    {{ filename | replace("?" + token, "") }}
                                {% else %}
                                    {{ filename }}
                                {% endif %}
                            </small>
                        </a>
                    </div>
                {% endfor %}
            </div>

            <!-- Hints -->
            <div class="challenge-hints hint-row row mb-3">
                {% for hint in hints %}
                    <div class="col-md-12 hint-button-wrapper text-center mb-2">
                        <a class="btn btn-outline-secondary btn-hint btn-block load-hint w-100" 
                           data-hint-id="{{ hint.id }}">
                            {% if hint.content %}
                                <small>View Hint</small>
                            {% else %}
                                {% if hint.cost %}
                                    <small>Unlock Hint for {{ hint.cost }} points</small>
                                {% else %}
                                    <small>View Hint</small>
                                {% endif %}
                            {% endif %}
                        </a>
                    </div>
                {% endfor %}
            </div>

            {% if max_attempts > 0 %}
            <div class="row text-center mb-3">
                <div class="col-md-12">
                    <p class="mb-0">{{ attempts }}/{{ max_attempts }} attempts</p>
                </div>
            </div>
            {% endif %}

            <!-- Flag submission form -->
            <div class="row submit-row">
                <div class="col-md-9 form-group">
                    <input id="challenge-id" class="challenge-id" type="hidden" value="{{ challenge.id }}">
                    <input id="challenge-input" class="challenge-input form-control" type="text" 
                           name="answer" placeholder="Flag">
                </div>
                <div class="col-md-3 form-group">
                    <button id="challenge-submit" class="challenge-submit btn btn-primary w-100" type="submit">
                        Submit
                    </button>
                </div>
            </div>

            <!-- Result notification -->
            <div class="row notification-row mt-3">
                <div class="col-md-12">
                    <div id="result-notification" class="alert alert-dismissible text-center w-100"
                         role="alert" style="display: none;">
                        <strong id="result-message"></strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
